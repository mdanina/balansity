# üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 007: Reverse Scoring –∏ –ü–æ—Ä–æ–≥–∏ –¥–ª—è –†–§

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —á–µ–∫–∞–ø–∞:
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–±—Ä–∞—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (reverse scoring)
- –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ—Ä–æ–≥–∏ –¥–ª—è –†–§ (–†–æ—Å—Å–∏–π—Å–∫–∞—è –§–µ–¥–µ—Ä–∞—Ü–∏—è)
- –ò—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –ø–æ–¥—Å—á–µ—Ç–∞

---

## üìù –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase

1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Supabase
2. –ù–∞–π–¥–∏—Ç–µ **SQL Editor** (–†–µ–¥–∞–∫—Ç–æ—Ä SQL) –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
3. –ù–∞–∂–º–∏—Ç–µ **New query** (–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)

---

## üìã –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 007

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è:

1. **–û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `calculate_checkup_scores`**:
   - Reverse scoring —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–≤ –∫–æ–¥–µ)
   - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–æ —Å—É–º–º–∏—Ä—É–µ—Ç —É–∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - –ò—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (value = -1) –∏–∑ –ø–æ–¥—Å—á–µ—Ç–∞

2. **–û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ—Ä–æ–≥–∏ –¥–ª—è –†–§**:
   - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã: ‚â• 5 –±–∞–ª–ª–æ–≤ (concerning)
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º: ‚â• 4 –±–∞–ª–ª–∞ (concerning)
   - –ì–∏–ø–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ‚â• 7 –±–∞–ª–ª–æ–≤ (concerning)
   - –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–∞–º–∏: ‚â• 4 –±–∞–ª–ª–∞ (concerning)

### –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase/migrations/007_fix_reverse_scoring_and_thresholds.sql`
2. **–í—ã–¥–µ–ª–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç** –≤ —Ñ–∞–π–ª–µ (Ctrl+A)
3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** (Ctrl+C)
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –≤ Supabase (Ctrl+V)
5. –ù–∞–∂–º–∏—Ç–µ **Run** (–í—ã–ø–æ–ª–Ω–∏—Ç—å) –∏–ª–∏ `Ctrl+Enter`
6. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è **"Success"** –∏–ª–∏ **"–£—Å–ø–µ—à–Ω–æ"**

---

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏:

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
SELECT routine_name, routine_definition
FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name = 'calculate_checkup_scores';
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤:

–§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- `emotional_score >= 5` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'concerning'
- `conduct_score >= 4` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'concerning'
- `hyperactivity_score >= 7` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'concerning'
- `peer_problems_score >= 4` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ 'concerning'

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —á–µ–∫–∞–ø—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º reverse scoring:

1. **–í–∞—Ä–∏–∞–Ω—Ç 1**: –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö assessments:
   ```sql
   -- –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ checkup assessments
   SELECT id, profile_id 
   FROM assessments 
   WHERE assessment_type = 'checkup' 
   AND status = 'completed';
   
   -- –î–ª—è –∫–∞–∂–¥–æ–≥–æ assessment –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   -- (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞—Ç—å complete_assessment –∑–∞–Ω–æ–≤–æ)
   ```

2. **–í–∞—Ä–∏–∞–Ω—Ç 2**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å - –Ω–æ–≤—ã–µ —á–µ–∫–∞–ø—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –ª—É—á—à–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —á–µ–∫–∞–ø–æ–≤, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º.

---

## üîç –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
- Reverse scoring –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥—Å—á–µ—Ç–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ü–æ—Ä–æ–≥–∏ –±—ã–ª–∏ –¥—Ä—É–≥–∏–º–∏ (–Ω–µ –¥–ª—è –†–§)

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ Reverse scoring –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–æ —Å—É–º–º–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ü–æ—Ä–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –†–§
- ‚úÖ –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –ø–æ–¥—Å—á–µ—Ç–∞

---

## üìû –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `calculate_checkup_scores` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –µ—ë (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)













