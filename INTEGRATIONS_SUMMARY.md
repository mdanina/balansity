# üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π Supabase

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. ‚è∞ Cron Jobs (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —á–µ–∫–∞–ø–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è—Ö –∫–∞–∂–¥—ã–π —á–∞—Å

**–§–∞–π–ª:** `supabase/migrations/030_setup_cron_jobs.sql`

### 2. üì¨ Queues (–û—á–µ—Ä–µ–¥–∏)
- `email_queue` - –æ—Ç–ø—Ä–∞–≤–∫–∞ email
- `report_generation_queue` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
- `payment_processing_queue` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- `analytics_queue` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–§–∞–π–ª:** `supabase/migrations/031_setup_queues.sql`

### 3. üîî Database Webhooks (–¢—Ä–∏–≥–≥–µ—Ä—ã)
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ–∫–∞–ø–∞ ‚Üí email + –æ—Ç—á–µ—Ç
- –ù–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–§–∞–π–ª:** `supabase/migrations/032_webhook_triggers.sql`

### 4. üîß Queue Worker (–û–±—Ä–∞–±–æ—Ç—á–∏–∫)
- Node.js —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π
- –û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP –æ—Ç nic.ru
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü–∞–ø–∫–∞:** `queue-worker/`

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```sql
-- –í SQL Editor Supabase –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
-- 030_setup_cron_jobs.sql
-- 031_setup_queues.sql
-- 032_webhook_triggers.sql
-- 033_pgmq_rpc_wrappers.sql
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Worker
```bash
cd queue-worker
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (—Å–º. .env.example)
npm install
npm run dev
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
- –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —á–µ–∫–∞–ø
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker'–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞

### Cron Jobs
```sql
SELECT * FROM cron.job;
```

### –û—á–µ—Ä–µ–¥–∏
```sql
SELECT * FROM pgmq.list_queues();
```

### Worker
```bash
pm2 status
# –∏–ª–∏
docker-compose ps
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `INTEGRATIONS_COMPLETE_DOCUMENTATION.md`
- **SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** `SMTP_SETUP_BALANSITY.md`
- **Worker:** `queue-worker/README.md`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é



