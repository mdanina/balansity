# üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 013: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–π —Å—Ö–µ–º–µ

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û!

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á–µ—Ç–∞** —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–π –∞–≤—Ç–æ—Ä—Å–∫–æ–π —Å—Ö–µ–º–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è:

### CHECKUP (–í–æ–ø—Ä–æ—Å—ã —Ä–µ–±–µ–Ω–∫–∞):

1. **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**: 
   - –ë—ã–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 1-5
   - –°—Ç–∞–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 2, 3, 4, 5, 6
   - –ü–æ—Ä–æ–≥: ‚â• 7 (–±—ã–ª–æ ‚â• 5)

2. **–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**: 
   - –ë—ã–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 6-10
   - –°—Ç–∞–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 7, 8 (–æ–±—Ä–∞—Ç–Ω–∞—è), 9, 10, 11
   - –ü–æ—Ä–æ–≥: ‚â• 4 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - ‚ö†Ô∏è –í–ê–ñ–ù–û: –í —Å—Ö–µ–º–µ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –≤–æ–ø—Ä–æ—Å 8 - –æ–±—Ä–∞—Ç–Ω–∞—è, –Ω–æ –≤ –∫–æ–¥–µ –æ–Ω –ù–ï –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `isReverse`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ!

3. **–ì–∏–ø–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 
   - –ë—ã–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 11-15
   - –°—Ç–∞–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 12, 13, 14, 15 (–æ–±—Ä–∞—Ç–Ω–∞—è), 16 (–æ–±—Ä–∞—Ç–Ω–∞—è)
   - –ü–æ—Ä–æ–≥: ‚â• 7 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–∞–º–∏**: 
   - –ë—ã–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 16-21
   - –°—Ç–∞–ª–æ: –≤–æ–ø—Ä–æ—Å—ã 17, 18, 19, 20 (–æ–±—Ä–∞—Ç–Ω–∞—è), 21 (–æ–±—Ä–∞—Ç–Ω–∞—è)
   - –ü–æ—Ä–æ–≥: ‚â• 4 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

5. **–í–ª–∏—è–Ω–∏–µ (Impact)** - **–ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù–û**:
   - –ë—ã–ª–æ: —Å—É–º–º–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã 22-31
   - –°—Ç–∞–ª–æ: —Ç—Ä–∏ —Å—É–±–¥–æ–º–µ–Ω–∞:
     - **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–±—ë–Ω–∫–∞**: –≤–æ–ø—Ä–æ—Å 23 (–ø–æ—Ä–æ–≥ ‚â• 2)
     - **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è**: –≤–æ–ø—Ä–æ—Å—ã 30, 31 (—Å—É–º–º–∞, –ø–æ—Ä–æ–≥ ‚â• 3)
     - **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–µ–º—å—é**: –≤–æ–ø—Ä–æ—Å—ã 24, 25, 26, 27, 28, 29 (—Å—É–º–º–∞, –ø–æ—Ä–æ–≥ ‚â• 6)

### PARENT (–í–æ–ø—Ä–æ—Å—ã —Ä–æ–¥–∏—Ç–µ–ª—è):

1. **–¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å (GAD-2)**: 
   - –í–æ–ø—Ä–æ—Å—ã: 2, 3 (–≤ –∫–æ–¥–µ id=2, 3)
   - –ü–æ—Ä–æ–≥: ‚â• 3 (–±—ã–ª–æ ‚â• 6)

2. **–î–µ–ø—Ä–µ—Å—Å–∏—è (PHQ-2)**: 
   - –í–æ–ø—Ä–æ—Å—ã: 4, 5 (–≤ –∫–æ–¥–µ id=4, 5)
   - –ü–æ—Ä–æ–≥: ‚â• 3 (–±—ã–ª–æ ‚â• 6)

3. **–û–±—â–∏–π –±–∞–ª–ª**: 
   - –ü–æ—Ä–æ–≥: ‚â• 6 (–±—ã–ª–æ ‚â• 10)

### FAMILY (–í–æ–ø—Ä–æ—Å—ã —Å–µ–º—å–∏):

1. **–°–µ–º–µ–π–Ω—ã–π —Å—Ç—Ä–µ—Å—Å**: 
   - –í–æ–ø—Ä–æ—Å: 1 (–≤ –∫–æ–¥–µ id=1)
   - –ü–æ—Ä–æ–≥: ‚â• 3 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

2. **–û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º**: 
   - –í–æ–ø—Ä–æ—Å—ã: 2 (–æ–±—Ä–∞—Ç–Ω–∞—è), 3 (–≤ –∫–æ–¥–µ id=2, 3)
   - –ü–æ—Ä–æ–≥: ‚â• 6 (–±—ã–ª–æ ‚â• 4)

3. **–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å—Ç–≤–æ**: 
   - –í–æ–ø—Ä–æ—Å—ã: 4 (–æ–±—Ä–∞—Ç–Ω–∞—è), 5 (–≤ –∫–æ–¥–µ id=4, 5)
   - –ü–æ—Ä–æ–≥: ‚â• 6 (–±—ã–ª–æ ‚â• 7)

---

## üìù –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 013

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase/migrations/013_fix_scoring_according_to_scheme.sql`
2. **–í—ã–¥–µ–ª–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç** (Ctrl+A)
3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** (Ctrl+C)
4. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Supabase ‚Üí SQL Editor
5. –í—Å—Ç–∞–≤—å—Ç–µ SQL –∫–æ–¥ (Ctrl+V)
6. –ù–∞–∂–º–∏—Ç–µ **Run** (–í—ã–ø–æ–ª–Ω–∏—Ç—å)
7. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è **"Success"**

---

## üìù –®–∞–≥ 2: –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏ (–º–∏–≥—Ä–∞—Ü–∏—è 014)

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase/migrations/014_recalculate_all_assessments.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
3. –≠—Ç–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏

---

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é checkup
SELECT routine_definition 
FROM information_schema.routines 
WHERE routine_name = 'calculate_checkup_scores';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é parent
SELECT routine_definition 
FROM information_schema.routines 
WHERE routine_name = 'calculate_parent_scores';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é family
SELECT routine_definition 
FROM information_schema.routines 
WHERE routine_name = 'calculate_family_scores';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å checkup —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
SELECT 
  id,
  results_summary->'emotional'->>'score' as emotional_score,
  results_summary->'emotional'->>'status' as emotional_status,
  results_summary->'impact_child'->>'score' as impact_child_score,
  results_summary->'impact_parent'->>'score' as impact_parent_score,
  results_summary->'impact_family'->>'score' as impact_family_score
FROM assessments 
WHERE assessment_type = 'checkup' 
AND status = 'completed'
LIMIT 5;
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

### 1. –í–æ–ø—Ä–æ—Å 8 (–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã):

–í —Å—Ö–µ–º–µ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –≤–æ–ø—Ä–æ—Å 8 - –æ–±—Ä–∞—Ç–Ω–∞—è, –Ω–æ –≤ –∫–æ–¥–µ (`checkupQuestions.ts`) –æ–Ω –ù–ï –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `isReverse`. 

–í–æ–ø—Ä–æ—Å 7 "–ú–æ–π —Ä–µ–±–µ–Ω–æ–∫ –æ–±—ã—á–Ω–æ —Ö–æ—Ä–æ—à–æ —Å–µ–±—è –≤–µ–¥–µ—Ç..." –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω—ã–π.

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –î–æ–ª–∂–µ–Ω –ª–∏ –≤–æ–ø—Ä–æ—Å 8 –±—ã—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–º?
- –ï—Å–ª–∏ –¥–∞, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `isReverse: true` –≤ `checkupQuestions.ts`

### 2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

–í —Å—Ö–µ–º–µ —É–∫–∞–∑–∞–Ω—ã –≤–æ–ø—Ä–æ—Å—ã 2, 3, 4, 5, 6, –Ω–æ –≤–æ–ø—Ä–æ—Å id=1 "–ú–æ–π —Ä–µ–±–µ–Ω–æ–∫ —á–∞—Å—Ç–æ –≥—Ä—É—Å—Ç–Ω—ã–π, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–π –∏–ª–∏ –ø–ª–∞—á–µ—Ç" —Ç–æ–∂–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π.

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –¥–æ–ª–∂–µ–Ω –ª–∏ –≤–æ–ø—Ä–æ—Å 1 –≤—Ö–æ–¥–∏—Ç—å –≤ –ø–æ–¥—Å—á–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º?

### 3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ResultsReportNew:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–∏ —Å—É–±–¥–æ–º–µ–Ω–∞ Impact:
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–±—ë–Ω–∫–∞
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è  
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–µ–º—å—é

–í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –æ–±—â–µ–≥–æ "impact".

---

## üîç –ß—Ç–æ –¥–∞–ª—å—à–µ:

1. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 013 –∏ 014
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ—Ü–µ–Ω–∫–∞—Ö
3. –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ResultsReportNew.tsx` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–µ—Ö —Å—É–±–¥–æ–º–µ–Ω–æ–≤ Impact
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤








