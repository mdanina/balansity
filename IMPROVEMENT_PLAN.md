# –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2024  
**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** ~15-20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

---

## üìä –û–±–∑–æ—Ä

–ü–ª–∞–Ω —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 4 —Ñ–∞–∑—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏:
- üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- üü° **–í–∞–∂–Ω–æ** - –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å  
- üü¢ **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ** - –£–ª—É—á—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- üîµ **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ** - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ü–ª–∞–Ω –¥–æ–ø–æ–ª–Ω–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –ö–ª–æ–¥–æ–º:
- N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ Dashboard (—ç–∫–æ–Ω–æ–º–∏—è ~600ms)
- –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ ResultsReportNew (—ç–∫–æ–Ω–æ–º–∏—è ~1.3s)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ composite –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è RLS
- –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ SQL —Ñ—É–Ω–∫—Ü–∏–∏
- React re-renders –ø—Ä–æ–±–ª–µ–º—ã

## üí¨ –û—Ü–µ–Ω–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ö–ª–æ–¥–∞

**–í–µ—Ä–¥–∏–∫—Ç:** –ê–Ω–∞–ª–∏–∑ –ö–ª–æ–¥–∞ **–æ—Ç–ª–∏—á–Ω—ã–π –∏ –æ—á–µ–Ω—å —Ç–æ—á–Ω—ã–π** ‚úÖ

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –∞–Ω–∞–ª–∏–∑ –æ—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–Ω—ã–º:

1. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –£–∫–∞–∑–∞–ª —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —ç–∫–æ–Ω–æ–º–∏–∏ (~600ms, ~1.3s)
   - –û–±—ä—è—Å–Ω–∏–ª –º–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã (N+1 –∑–∞–ø—Ä–æ—Å—ã)

2. **–ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
   - –ù–∞—à–µ–ª –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL (scoring —Ñ—É–Ω–∫—Ü–∏–∏)
   - –û–±–Ω–∞—Ä—É–∂–∏–ª –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –¥–ª—è RLS
   - –í—ã—è–≤–∏–ª –ø—Ä–æ–±–ª–µ–º—ã React re-renders

3. **–ü—Ä–∞–∫—Ç–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
   - –ü—Ä–µ–¥–ª–æ–∂–∏–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - –£–∫–∞–∑–∞–ª –≤—ã–∏–≥—Ä—ã—à –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

4. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:**
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–¥–µ–ª–∏–ª –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –†–∞–∑–¥–µ–ª–∏–ª –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø–ª–∞–Ω –æ—Ç –ö–ª–æ–¥–∞:

- ‚úÖ **1.6** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ N+1 –≤ Dashboard (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ **1.7** - –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ResultsReportNew (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ **1.8** - Composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è RLS (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ **2.3** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL —Ñ—É–Ω–∫—Ü–∏–π (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ **2.3.1** - –ë–∞—Ç—á–µ–≤—ã–π UPDATE (–≤–∞–∂–Ω–æ)
- ‚úÖ **2.3.2** - React Query –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–∞–∂–Ω–æ)
- ‚úÖ **2.4** - –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å useCallback (–≤–∞–∂–Ω–æ)
- ‚úÖ **2.5** - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ UI updates (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
- ‚úÖ **2.6** - Bundle size –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

### –ß—Ç–æ —É–∂–µ –±—ã–ª–æ –≤ –ø–ª–∞–Ω–µ:

- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∑–∞–º–µ–Ω–∏—Ç console.log)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (—á–∞—Å—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è)
- ‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è (–Ω–æ –±–µ–∑ useCallback - —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª–µ–Ω–æ)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–ù–∞—á–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç –ö–ª–æ–¥–∞!**
1. N+1 –∑–∞–ø—Ä–æ—Å—ã (1.6) - **–°–†–û–ß–ù–û**
2. ResultsReportNew (1.7) - **–°–†–û–ß–ù–û**
3. Composite –∏–Ω–¥–µ–∫—Å—ã (1.8) - **–°–†–û–ß–ù–û**
4. SQL —Ñ—É–Ω–∫—Ü–∏–∏ (2.3) - **–í–ê–ñ–ù–û**

–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–¥—É—Ç **~2+ —Å–µ–∫—É–Ω–¥—ã —ç–∫–æ–Ω–æ–º–∏–∏** –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏! üöÄ

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò (–æ—Ç –ö–ª–æ–¥–∞)

**–û—Ü–µ–Ω–∫–∞ –ö–ª–æ–¥–∞ –æ—á–µ–Ω—å —Ç–æ—á–Ω–∞!** –ù–∏–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø–ª–∞–Ω —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º.

---

## –§–ê–ó–ê 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (3-4 –¥–Ω—è)

### üî¥ 1.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª—ã:** 
- –°–æ–∑–¥–∞—Ç—å: `src/lib/logger.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: –≤—Å–µ —Ñ–∞–π–ª—ã —Å console.log

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É logger
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ console.log –Ω–∞ logger
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ª–æ–≥–æ–≤ –≤ production

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```typescript
// src/lib/logger.ts
const isDev = import.meta.env.DEV;
const isTest = import.meta.env.MODE === 'test';

interface LogLevel {
  log: 'log';
  info: 'info';
  warn: 'warn';
  error: 'error';
}

class Logger {
  private shouldLog(level: keyof LogLevel): boolean {
    if (level === 'error') return true; // –í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    return isDev && !isTest;
  }

  log(...args: unknown[]): void {
    if (this.shouldLog('log')) {
      console.log('[LOG]', ...args);
    }
  }

  info(...args: unknown[]): void {
    if (this.shouldLog('info')) {
      console.info('[INFO]', ...args);
    }
  }

  warn(...args: unknown[]): void {
    if (this.shouldLog('warn')) {
      console.warn('[WARN]', ...args);
    }
  }

  error(...args: unknown[]): void {
    console.error('[ERROR]', ...args);
    // TODO: –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Sentry/–¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å
  }
}

export const logger = new Logger();
```

**–ó–∞–º–µ–Ω–∞ –≤ –∫–æ–¥–µ:**

```typescript
// –ë—ã–ª–æ:
console.log('User created:', user);

// –°—Ç–∞–ª–æ:
import { logger } from '@/lib/logger';
logger.log('User created:', user);
```

---

### üî¥ 1.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç  
**–§–∞–π–ª:** `src/lib/supabase.ts`

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å throw –≤–º–µ—Å—Ç–æ warn
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ URL

**–ö–æ–¥:**

```typescript
// src/lib/supabase.ts
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';

function validateEnv(): void {
  const errors: string[] = [];

  if (!supabaseUrl) {
    errors.push('VITE_SUPABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
  } else if (!supabaseUrl.startsWith('http')) {
    errors.push('VITE_SUPABASE_URL –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
  }

  if (!supabaseAnonKey) {
    errors.push('VITE_SUPABASE_ANON_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
  }

  if (errors.length > 0) {
    throw new Error(
      `–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:\n${errors.join('\n')}`
    );
  }
}

// –í—ã–∑—ã–≤–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ä–∞–∑—É
validateEnv();

export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
  },
});
```

---

### üî¥ 1.3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `src/lib/authUtils.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/contexts/AuthContext.tsx`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/components/ProtectedRoute.tsx`

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–π
- [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ö–æ–¥:**

```typescript
// src/lib/authUtils.ts
import type { Session } from '@supabase/supabase-js';

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∞–ª–∏–¥–Ω–∞ –ª–∏ —Å–µ—Å—Å–∏—è (–Ω–µ –∏—Å—Ç–µ–∫–ª–∞)
 */
export function isSessionValid(session: Session | null): boolean {
  if (!session) return false;
  
  const now = Math.floor(Date.now() / 1000);
  const expiresAt = session.expires_at;
  
  // –ï—Å–ª–∏ expires_at –Ω–µ —É–∫–∞–∑–∞–Ω, —Å—á–∏—Ç–∞–µ–º —Å–µ—Å—Å–∏—é –≤–∞–ª–∏–¥–Ω–æ–π
  // (Supabase –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  return !expiresAt || expiresAt >= now;
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∏—Å—Ç–µ–∫–ª–∞ –ª–∏ —Å–µ—Å—Å–∏—è
 */
export function isSessionExpired(session: Session | null): boolean {
  if (!session) return true;
  
  const now = Math.floor(Date.now() / 1000);
  const expiresAt = session.expires_at;
  
  return expiresAt ? expiresAt < now : false;
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AuthContext:**

```typescript
// src/contexts/AuthContext.tsx
import { isSessionValid, isSessionExpired } from '@/lib/authUtils';

// –í useEffect:
if (session) {
  if (isSessionExpired(session)) {
    logger.warn('Session expired, clearing...');
    supabase.auth.signOut();
    setSession(null);
    setUser(null);
  } else {
    setSession(session);
    setUser(session.user ?? null);
  }
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ProtectedRoute:**

```typescript
// src/components/ProtectedRoute.tsx
import { isSessionValid } from '@/lib/authUtils';

if (!user || !isSessionValid(session)) {
  return <Navigate to="/login" replace />;
}
```

---

### üî¥ 1.4. –ó–∞–º–µ–Ω–∞ alert() –Ω–∞ toast

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–í—Ä–µ–º—è:** 15 –º–∏–Ω—É—Ç  
**–§–∞–π–ª:** `src/pages/Dashboard.tsx`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å alert –Ω–∞ toast.error –∏–ª–∏ toast.info

**–ö–æ–¥:**

```typescript
// –ë—ã–ª–æ:
alert('–í—Å–µ –¥–µ—Ç–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏ —á–µ–∫–∞–ø!...');

// –°—Ç–∞–ª–æ:
import { toast } from 'sonner';

toast.info('–í—Å–µ –¥–µ—Ç–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏ —á–µ–∫–∞–ø! –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–í–∞—à–∞ —Å–µ–º—å—è".');
```

---

### üî¥ 1.5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–í—Ä–µ–º—è:** 1 —á–∞—Å  
**–§–∞–π–ª—ã:**
- `src/lib/profileStorage.ts`
- `src/pages/Dashboard.tsx`

**–ó–∞–¥–∞—á–∏:**
- [ ] –£–¥–∞–ª–∏—Ç—å –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥ –≤ profileStorage.ts (—Å—Ç—Ä–æ–∫–∞ 162)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å calculateAge –≤ Dashboard –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–ö–æ–¥:**

```typescript
// src/pages/Dashboard.tsx
import { calculateAge } from '@/lib/profileStorage';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
const age = member.dob ? calculateAge(member.dob) : null;
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ profileStorage.ts:**

```typescript
// –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É 162: if (error) throw error;
// –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 152
```

---

### üî¥ 1.6. –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Dashboard ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- `src/pages/Dashboard.tsx`
- `src/lib/assessmentStorage.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –¥–µ–ª–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î.
- 5 –ø—Ä–æ—Ñ–∏–ª–µ–π = 5 –∑–∞–ø—Ä–æ—Å–æ–≤ = ~750ms –∑–∞–¥–µ—Ä–∂–∫–∏
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ RLS —Å JOIN

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é batch –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ü–µ–Ω–æ–∫
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Dashboard –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è batch –∑–∞–ø—Ä–æ—Å–∞

**–ö–æ–¥:** (—É–∂–µ –µ—Å—Ç—å –≤ –ø–ª–∞–Ω–µ, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º)

```typescript
// src/lib/assessmentStorage.ts - –î–û–ë–ê–í–ò–¢–¨ –°–†–û–ß–ù–û

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
 * –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç N+1 –ø—Ä–æ–±–ª–µ–º—É
 */
export async function getCompletedAssessmentsForProfiles(
  profileIds: string[],
  assessmentType: 'checkup' | 'parent' | 'family'
): Promise<Record<string, Assessment | null>> {
  if (profileIds.length === 0) {
    return {};
  }

  try {
    const { data, error } = await supabase
      .from('assessments')
      .select('*')
      .in('profile_id', profileIds)
      .eq('assessment_type', assessmentType)
      .eq('status', 'completed')
      .order('completed_at', { ascending: false });

    if (error) throw error;

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ profile_id, –±–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É
    const assessmentMap = data?.reduce((acc, assessment) => {
      // –ï—Å–ª–∏ –µ—â–µ –Ω–µ—Ç –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è, –∏–ª–∏ —ç—Ç–∞ –Ω–æ–≤–µ–µ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º
      if (!acc[assessment.profile_id] || 
          (!acc[assessment.profile_id].completed_at && assessment.completed_at) ||
          (acc[assessment.profile_id].completed_at && assessment.completed_at &&
           new Date(assessment.completed_at) > new Date(acc[assessment.profile_id].completed_at!))) {
        acc[assessment.profile_id] = assessment;
      }
      return acc;
    }, {} as Record<string, Assessment>) || {};

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º Map —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ (null –¥–ª—è —Ç–µ—Ö, —É –∫–æ–≥–æ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫)
    const result: Record<string, Assessment | null> = {};
    for (const profileId of profileIds) {
      result[profileId] = assessmentMap[profileId] || null;
    }

    return result;
  } catch (error) {
    logger.error('Error getting assessments for profiles:', error);
    throw error;
  }
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Dashboard.tsx:**

```typescript
// src/pages/Dashboard.tsx
import { getCompletedAssessmentsForProfiles } from '@/lib/assessmentStorage';

useEffect(() => {
  async function loadMembers() {
    if (!user) {
      setLoading(false);
      return;
    }

    try {
      setLoading(true);
      const profiles = await getProfiles();
      
      // –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤!
      const profileIds = profiles.map(p => p.id);
      const assessmentsMap = await getCompletedAssessmentsForProfiles(
        profileIds,
        'checkup'
      );
      
      const membersWithAssessments = profiles.map(profile => ({
        ...profile,
        checkupAssessment: assessmentsMap[profile.id] || null,
      }));
      
      setFamilyMembers(membersWithAssessments);
    } catch (error) {
      logger.error('Error loading family members:', error);
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    } finally {
      setLoading(false);
    }
  }
  loadMembers();
}, [user]);
```

**–í—ã–∏–≥—Ä—ã—à:** 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N, ~600ms —ç–∫–æ–Ω–æ–º–∏–∏ –¥–ª—è 5 –ø—Ä–æ—Ñ–∏–ª–µ–π, ~1.5s –¥–ª—è 10 –ø—Ä–æ—Ñ–∏–ª–µ–π

---

### üî¥ 1.7. –ö–†–ò–¢–ò–ß–ù–û: –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ ResultsReportNew üî•üî•üî•

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞  
**–§–∞–π–ª:** `src/pages/ResultsReportNew.tsx`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –ë–î!
- O(N √ó M) —Å–ª–æ–∂–Ω–æ—Å—Ç—å: N = –ø—Ä–æ—Ñ–∏–ª–∏, M = —Ç–∏–ø—ã –æ—Ü–µ–Ω–æ–∫
- –î–ª—è 5 –ø—Ä–æ—Ñ–∏–ª–µ–π = –¥–æ 10 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~1.5 —Å–µ–∫—É–Ω–¥—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã!

**–ó–∞–¥–∞—á–∏:**
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ–¥–∏–Ω batch –∑–∞–ø—Ä–æ—Å
- [ ] –£–±—Ä–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã

**–ö–æ–¥:**

```typescript
// src/pages/ResultsReportNew.tsx
// –ó–ê–ú–ï–ù–ò–¢–¨ –≤–µ—Å—å –±–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç—Ä–æ–∫–∏ 109-150)

useEffect(() => {
  async function loadResults() {
    if (authLoading || !user) {
      return;
    }
    
    try {
      setLoading(true);
      
      // –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const { data: profiles, error: profilesError } = await supabase
        .from('profiles')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at', { ascending: true });

      if (profilesError) throw profilesError;
      if (!profiles) return;

      const parentProfile = profiles.find(p => p.type === 'parent');
      const partnerProfile = profiles.find(p => p.type === 'partner');
      const childProfiles = profiles.filter(p => p.type === 'child');

      setParentProfile(parentProfile || null);
      setPartnerProfile(partnerProfile || null);

      // –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –¥–ª—è –í–°–ï–• –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const { data: allAssessments, error: assessmentsError } = await supabase
        .from('assessments')
        .select('*, profile_id')
        .in('profile_id', profiles.map(p => p.id))
        .eq('status', 'completed')
        .in('assessment_type', ['parent', 'family', 'checkup']);

      if (assessmentsError) throw assessmentsError;

      // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º
      const parentAssess = allAssessments?.find(
        a => a.assessment_type === 'parent'
      ) || null;
      
      const familyAssess = allAssessments?.find(
        a => a.assessment_type === 'family'
      ) || null;

      // –ß–µ–∫–∞–ø—ã –¥–µ—Ç–µ–π
      const checkupAssessments = allAssessments?.filter(
        a => a.assessment_type === 'checkup'
      ) || [];

      const checkupsMap = new Map(
        checkupAssessments.map(a => [a.profile_id, a])
      );

      const childrenCheckups: ChildCheckupData[] = childProfiles.map(child => ({
        profile: child,
        checkup: checkupsMap.get(child.id) || null,
      }));

      setChildrenCheckups(childrenCheckups);
      setParentAssessment(parentAssess);
      setFamilyAssessment(familyAssess);
    } catch (error) {
      logger.error('Error loading results:', error);
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    } finally {
      setLoading(false);
    }
  }

  loadResults();
}, [authLoading, user]);

// –£–î–ê–õ–ò–¢–¨ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏:
// ‚ùå for (const profile of profiles) {
// ‚ùå   if (!parentAssessment) {
// ‚ùå     const parentAssess = await getCompletedAssessment(...);
// ‚ùå   }
// ‚ùå }
```

**–í—ã–∏–≥—Ä—ã—à:** 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 10+, ~1.3 —Å–µ–∫—É–Ω–¥—ã —ç–∫–æ–Ω–æ–º–∏–∏!

---

### üî¥ 1.8. –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Composite –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è RLS üî¥

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–§–∞–π–ª:** –°–æ–∑–¥–∞—Ç—å `supabase/migrations/011_add_composite_indexes.sql`

**–ü—Ä–æ–±–ª–µ–º–∞:** RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–µ–ª–∞—é—Ç JOIN, –Ω–æ –Ω–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ ‚Üí –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å composite –∏–Ω–¥–µ–∫—Å–∞–º–∏
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

**–ö–æ–¥:**

```sql
-- supabase/migrations/011_add_composite_indexes.sql

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ RLS –ø–æ–ª–∏—Ç–∏–∫
-- –£—Å–∫–æ—Ä—è—é—Ç JOIN –∑–∞–ø—Ä–æ—Å—ã –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

-- –î–ª—è —Ç–∞–±–ª–∏—Ü—ã assessments: —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (id, profile_id) –≤ JOIN
CREATE INDEX IF NOT EXISTS idx_assessments_id_profile_id 
  ON public.assessments(id, profile_id);

-- –î–ª—è —Ç–∞–±–ª–∏—Ü—ã profiles: —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (id, user_id) –≤ JOIN
CREATE INDEX IF NOT EXISTS idx_profiles_id_user_id 
  ON public.profiles(id, user_id);

-- –î–ª—è —Ç–∞–±–ª–∏—Ü—ã answers: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è scoring –∑–∞–ø—Ä–æ—Å–æ–≤
-- Partial index –¥–ª—è –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
CREATE INDEX IF NOT EXISTS idx_answers_assessment_value_type 
  ON public.answers(assessment_id, answer_type, value) 
  WHERE value >= 0;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ —Ç–∏–ø—É
CREATE INDEX IF NOT EXISTS idx_assessments_type_status_profile 
  ON public.assessments(assessment_type, status, profile_id)
  WHERE status = 'completed';

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
COMMENT ON INDEX idx_assessments_id_profile_id IS 
  '–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç RLS JOIN –º–µ–∂–¥—É assessments –∏ profiles';
COMMENT ON INDEX idx_profiles_id_user_id IS 
  '–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç RLS –ø—Ä–æ–≤–µ—Ä–∫–∏ user_id –≤ profiles';
COMMENT ON INDEX idx_answers_assessment_value_type IS 
  '–£—Å–∫–æ—Ä—è–µ—Ç scoring –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ –æ—Ü–µ–Ω–æ–∫';
```

**–í—ã–∏–≥—Ä—ã—à:** 2-5x —É—Å–∫–æ—Ä–µ–Ω–∏–µ RLS –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ JOIN –∑–∞–ø—Ä–æ—Å–æ–≤

---

### üü° 2.5. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ UI updates

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- `src/hooks/useAssessment.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç —Å–µ—Ç–∏
- UI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
- –ü–ª–æ—Ö–æ–π UX –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–ö–æ–¥:**

```typescript
// src/hooks/useAssessment.ts
const saveAnswerToDb = async (
  questionId: number,
  questionCode: string,
  category: string,
  value: number,
  answerType: string | undefined,
  stepNumber: number
) => {
  if (!assessmentId) {
    logger.warn('Assessment ID not available');
    return;
  }

  // –û–ü–¢–ò–ú–ò–°–¢–ò–ß–ù–û–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å—Ä–∞–∑—É
  const previousValue = savedAnswers.get(questionId);
  const previousStep = currentStep;
  
  setSavedAnswers(prev => new Map(prev).set(questionId, value));
  setCurrentStep(stepNumber);

  try {
    const answerData: AnswerData = {
      questionId,
      questionCode,
      category,
      value,
      answerType,
      stepNumber,
    };

    await saveAnswer(assessmentId, answerData);
    await updateAssessmentStep(assessmentId, stepNumber);
    
    // –£—Å–ø–µ—Ö - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
  } catch (error) {
    // –û–¢–ö–ê–¢ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    logger.error('Error saving answer:', error);
    
    setSavedAnswers(prev => {
      const newMap = new Map(prev);
      if (previousValue !== undefined) {
        newMap.set(questionId, previousValue);
      } else {
        newMap.delete(questionId);
      }
      return newMap;
    });
    
    setCurrentStep(previousStep);
    
    toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
  }
};
```

**–í—ã–∏–≥—Ä—ã—à:** –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ UI, –ª—É—á—à–∏–π UX

---

## –§–ê–ó–ê 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (5-7 –¥–Ω–µ–π)

### üü° 2.1. –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ  
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `src/lib/errorHandler.ts`
- –°–æ–∑–¥–∞—Ç—å: `src/types/errors.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: –≤—Å–µ —Ñ–∞–π–ª—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞

**–ö–æ–¥:**

```typescript
// src/types/errors.ts
export interface AppError {
  message: string;
  code?: string;
  statusCode?: number;
  originalError?: unknown;
}

export class ApiError extends Error {
  constructor(
    message: string,
    public code?: string,
    public statusCode?: number,
    public originalError?: unknown
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

export class ValidationError extends Error {
  constructor(message: string, public field?: string) {
    super(message);
    this.name = 'ValidationError';
  }
}
```

```typescript
// src/lib/errorHandler.ts
import { logger } from './logger';
import { toast } from 'sonner';
import type { AppError, ApiError } from '@/types/errors';

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
 */
export function getErrorMessage(error: unknown): string {
  if (error instanceof Error) {
    return error.message;
  }
  
  if (typeof error === 'string') {
    return error;
  }
  
  if (error && typeof error === 'object' && 'message' in error) {
    return String(error.message);
  }
  
  return '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É API —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export async function handleApiError<T>(
  operation: () => Promise<T>,
  userMessage?: string
): Promise<T> {
  try {
    return await operation();
  } catch (error) {
    const message = getErrorMessage(error);
    
    logger.error('API Error:', error);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    toast.error(userMessage || message);
    
    // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
    throw error;
  }
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ Supabase
 */
export function handleSupabaseError(error: unknown): AppError {
  if (error && typeof error === 'object' && 'code' in error) {
    const supabaseError = error as { code?: string; message?: string };
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫–æ–¥–æ–≤ Supabase
    switch (supabaseError.code) {
      case 'PGRST116':
        return {
          message: '–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞',
          code: 'NOT_FOUND',
        };
      case '23505': // Unique violation
        return {
          message: '–ó–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç',
          code: 'DUPLICATE',
        };
      default:
        return {
          message: supabaseError.message || '–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
          code: supabaseError.code,
        };
    }
  }
  
  return {
    message: getErrorMessage(error),
  };
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
// –ë—ã–ª–æ:
try {
  const profiles = await getProfiles();
  setProfiles(profiles);
} catch (error) {
  console.error('Error:', error);
  toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª–µ–π');
}

// –°—Ç–∞–ª–æ:
import { handleApiError } from '@/lib/errorHandler';

try {
  const profiles = await handleApiError(
    () => getProfiles(),
    '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.'
  );
  setProfiles(profiles);
} catch (error) {
  // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ –ø–æ–∫–∞–∑–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  // –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
}
```

---

### üü° 2.2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º —Å Zod

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ  
**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `src/lib/validation/schemas.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/pages/Register.tsx`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/pages/Login.tsx`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/pages/Profile.tsx`

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å react-hook-form
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ö–æ–¥:**

```typescript
// src/lib/validation/schemas.ts
import { z } from 'zod';

export const emailSchema = z.string().email('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');

export const passwordSchema = z
  .string()
  .min(6, '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤')
  .max(100, '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π');

export const registerSchema = z
  .object({
    email: emailSchema,
    password: passwordSchema,
    confirmPassword: z.string(),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç',
    path: ['confirmPassword'],
  });

export const loginSchema = z.object({
  email: emailSchema,
  password: z.string().min(1, '–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'),
});

export const phoneSchema = z
  .string()
  .regex(/^\+?[1-9]\d{1,14}$/, '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');

export const profileSchema = z.object({
  firstName: z.string().min(1, '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'),
  lastName: z.string().optional(),
  phone: phoneSchema.optional().or(z.literal('')),
  region: z.string().optional(),
});

export type RegisterInput = z.infer<typeof registerSchema>;
export type LoginInput = z.infer<typeof loginSchema>;
export type ProfileInput = z.infer<typeof profileSchema>;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Register.tsx:**

```typescript
// src/pages/Register.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { registerSchema, type RegisterInput } from '@/lib/validation/schemas';

export default function Register() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<RegisterInput>({
    resolver: zodResolver(registerSchema),
  });

  const onSubmit = async (data: RegisterInput) => {
    const { error } = await signIn(data.email, data.password);
    if (error) {
      toast.error(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
    }
    // ...
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div>
        <Label htmlFor="email">Email</Label>
        <Input
          id="email"
          type="email"
          {...register('email')}
          aria-invalid={errors.email ? 'true' : 'false'}
        />
        {errors.email && (
          <p className="text-sm text-destructive mt-1">{errors.email.message}</p>
        )}
      </div>
      {/* ... */}
    </form>
  );
}
```

---

### üü° 2.3. –ö–†–ò–¢–ò–ß–ù–û: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL —Ñ—É–Ω–∫—Ü–∏–π (5 SELECT ‚Üí 1)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª:** `supabase/migrations/012_optimize_scoring_functions.sql`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SELECT –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ scoring —Ñ—É–Ω–∫—Ü–∏—è—Ö
- 5 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SELECT –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã answers
- –ö–∞–∂–¥—ã–π SELECT –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å –∏ –∫–µ—à
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–ó–∞–¥–∞—á–∏:**
- [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SELECT –≤ –æ–¥–∏–Ω —Å CASE
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ calculate_parent_scores –∏ calculate_family_scores

**–ö–æ–¥:**

```sql
-- supabase/migrations/012_optimize_scoring_functions.sql

-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è calculate_parent_scores
-- –ë–´–õ–û: 5 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SELECT
-- –°–¢–ê–õ–û: 1 SELECT —Å CASE

CREATE OR REPLACE FUNCTION calculate_parent_scores(assessment_uuid uuid)
RETURNS jsonb
LANGUAGE plpgsql
AS $$
DECLARE
  wellbeing_value numeric;
  relationship_value numeric;
  arguments_value numeric;
  coparenting_together_value numeric;
  coparenting_arguments_value numeric;
  -- ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
BEGIN
  -- –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 5!
  SELECT 
    MAX(CASE WHEN question_id = 1 AND answer_type = 'wellbeing' THEN value END)::numeric,
    MAX(CASE WHEN question_id = 2 AND answer_type = 'relationship' AND value < 6 THEN value END)::numeric,
    MAX(CASE WHEN question_id = 3 AND answer_type = 'frequency' AND value < 6 THEN value END)::numeric,
    MAX(CASE WHEN question_id = 4 AND answer_type = 'frequency' AND value < 6 THEN value END)::numeric,
    MAX(CASE WHEN question_id = 5 AND answer_type = 'frequency' AND value < 6 THEN value END)::numeric
    -- –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ CASE –¥–ª—è –¥—Ä—É–≥–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  INTO 
    wellbeing_value,
    relationship_value,
    arguments_value,
    coparenting_together_value,
    coparenting_arguments_value
  FROM public.answers
  WHERE assessment_id = assessment_uuid
    AND question_id BETWEEN 1 AND 25  -- –∏–ª–∏ –≤–∞—à –¥–∏–∞–ø–∞–∑–æ–Ω
    AND value >= 0;

  -- –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤...
  
  RETURN jsonb_build_object(
    'wellbeing', wellbeing_value,
    'relationship', relationship_value,
    -- ...
  );
END;
$$;

-- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å calculate_family_scores
```

**–í—ã–∏–≥—Ä—ã—à:** 5x –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞, ~200-300ms —ç–∫–æ–Ω–æ–º–∏–∏

---

### üü° 2.3.1. –ë–∞—Ç—á–µ–≤—ã–π UPDATE –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 010

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 1 —á–∞—Å  
**–§–∞–π–ª:** `supabase/migrations/010_recalculate_existing_assessments.sql`

**–ü—Ä–æ–±–ª–µ–º–∞:** UPDATE –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
- –ù–µ set-based –æ–ø–µ—Ä–∞—Ü–∏—è
- –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É
- –†–∏—Å–∫ deadlock

**–ó–∞–¥–∞—á–∏:**
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ –±–∞—Ç—á–µ–≤—ã–π UPDATE —Å SKIP LOCKED

**–ö–æ–¥:**

```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è 010_recalculate_existing_assessments.sql

DO $$
DECLARE
  batch_size INT := 100;
  updated_rows INT;
  total_updated INT := 0;
BEGIN
  LOOP
    -- –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö —Å—Ç—Ä–æ–∫
    WITH batch AS (
      SELECT id 
      FROM public.assessments
      WHERE assessment_type = 'parent' 
        AND status = 'completed'
        AND (results_summary IS NULL 
             OR results_summary = '{"status": "completed"}'::jsonb
             OR jsonb_typeof(results_summary) = 'null')
      LIMIT batch_size
      FOR UPDATE SKIP LOCKED  -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
    )
    UPDATE public.assessments a
    SET 
      results_summary = calculate_parent_scores(a.id),
      updated_at = now()
    FROM batch b
    WHERE a.id = b.id;

    GET DIAGNOSTICS updated_rows = ROW_COUNT;
    total_updated := total_updated + updated_rows;
    
    EXIT WHEN updated_rows = 0;
    
    -- –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
    PERFORM pg_sleep(0.1);
  END LOOP;

  RAISE NOTICE '–û–±–Ω–æ–≤–ª–µ–Ω–æ % —Å—Ç—Ä–æ–∫', total_updated;
END $$;

-- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è family assessments
DO $$
DECLARE
  batch_size INT := 100;
  updated_rows INT;
  total_updated INT := 0;
BEGIN
  LOOP
    WITH batch AS (
      SELECT id 
      FROM public.assessments
      WHERE assessment_type = 'family' 
        AND status = 'completed'
        AND (results_summary IS NULL 
             OR results_summary = '{"status": "completed"}'::jsonb
             OR jsonb_typeof(results_summary) = 'null')
      LIMIT batch_size
      FOR UPDATE SKIP LOCKED
    )
    UPDATE public.assessments a
    SET 
      results_summary = calculate_family_scores(a.id),
      updated_at = now()
    FROM batch b
    WHERE a.id = b.id;

    GET DIAGNOSTICS updated_rows = ROW_COUNT;
    total_updated := total_updated + updated_rows;
    
    EXIT WHEN updated_rows = 0;
    
    PERFORM pg_sleep(0.1);
  END LOOP;

  RAISE NOTICE '–û–±–Ω–æ–≤–ª–µ–Ω–æ % —Å—Ç—Ä–æ–∫', total_updated;
END $$;
```

**–í—ã–∏–≥—Ä—ã—à:** –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

### üü° 2.3.2. –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ React Query –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è ‚ö†Ô∏è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- `src/pages/Dashboard.tsx`
- `src/pages/ResultsReportNew.tsx`
- –°–æ–∑–¥–∞—Ç—å: `src/hooks/useProfiles.ts`
- –°–æ–∑–¥–∞—Ç—å: `src/hooks/useAssessments.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ —á–∞—Å—Ç–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ö—É–∫–∏ —Å React Query
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –æ—Ü–µ–Ω–æ–∫
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—É–∫–æ–≤

**–ö–æ–¥:**

```typescript
// src/hooks/useProfiles.ts
import { useQuery } from '@tanstack/react-query';
import { getProfiles } from '@/lib/profileStorage';
import { useAuth } from '@/contexts/AuthContext';

export function useProfiles() {
  const { user } = useAuth();

  return useQuery({
    queryKey: ['profiles', user?.id],
    queryFn: getProfiles,
    enabled: !!user, // –ó–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    staleTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç - –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–º–∏
    cacheTime: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç - –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ
    retry: 2, // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ 2 —Ä–∞–∑–∞
  });
}
```

```typescript
// src/hooks/useAssessments.ts
import { useQuery } from '@tanstack/react-query';
import { getCompletedAssessmentsForProfiles } from '@/lib/assessmentStorage';

export function useAssessmentsForProfiles(
  profileIds: string[],
  assessmentType: 'checkup' | 'parent' | 'family'
) {
  return useQuery({
    queryKey: ['assessments', profileIds.sort().join(','), assessmentType],
    queryFn: () => getCompletedAssessmentsForProfiles(profileIds, assessmentType),
    enabled: profileIds.length > 0, // –ó–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏
    staleTime: 5 * 60 * 1000,
    cacheTime: 10 * 60 * 1000,
  });
}
```

```typescript
// src/pages/Dashboard.tsx
import { useProfiles } from '@/hooks/useProfiles';
import { useAssessmentsForProfiles } from '@/hooks/useAssessments';

export default function Dashboard() {
  const { user } = useAuth();
  const { data: profiles = [], isLoading: profilesLoading, error: profilesError } = useProfiles();
  
  const profileIds = useMemo(() => profiles.map(p => p.id), [profiles]);
  const { 
    data: assessmentsMap = {}, 
    isLoading: assessmentsLoading 
  } = useAssessmentsForProfiles(profileIds, 'checkup');

  const familyMembers = useMemo(() => {
    return profiles.map(profile => ({
      ...profile,
      checkupAssessment: assessmentsMap[profile.id] || null,
    }));
  }, [profiles, assessmentsMap]);

  const loading = profilesLoading || assessmentsLoading;

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  useEffect(() => {
    if (profilesError) {
      logger.error('Error loading profiles:', profilesError);
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    }
  }, [profilesError]);

  // –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...
}
```

**–í—ã–∏–≥—Ä—ã—à:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö, –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î

---

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- `src/pages/Dashboard.tsx`
- –°–æ–∑–¥–∞—Ç—å: `src/lib/assessmentStorage.ts` (–¥–æ–ø–æ–ª–Ω–∏—Ç—å)

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è batch –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ü–µ–Ω–æ–∫
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ Dashboard

**–ö–æ–¥:**

```typescript
// src/lib/assessmentStorage.ts - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
 */
export async function getCompletedAssessmentsForProfiles(
  profileIds: string[],
  assessmentType: 'checkup' | 'parent' | 'family'
): Promise<Map<string, Assessment | null>> {
  if (profileIds.length === 0) {
    return new Map();
  }

  try {
    const { data, error } = await supabase
      .from('assessments')
      .select('*')
      .in('profile_id', profileIds)
      .eq('assessment_type', assessmentType)
      .eq('status', 'completed')
      .order('completed_at', { ascending: false });

    if (error) throw error;

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ profile_id, –±–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    const assessmentMap = new Map<string, Assessment>();
    const seenProfiles = new Set<string>();

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –±–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    for (const assessment of data || []) {
      if (!seenProfiles.has(assessment.profile_id)) {
        assessmentMap.set(assessment.profile_id, assessment);
        seenProfiles.add(assessment.profile_id);
      }
    }

    // –ó–∞–ø–æ–ª–Ω—è–µ–º null –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –±–µ–∑ –æ—Ü–µ–Ω–æ–∫
    const result = new Map<string, Assessment | null>();
    for (const profileId of profileIds) {
      result.set(profileId, assessmentMap.get(profileId) || null);
    }

    return result;
  } catch (error) {
    logger.error('Error getting assessments for profiles:', error);
    throw error;
  }
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Dashboard.tsx:**

```typescript
// src/pages/Dashboard.tsx
import { getCompletedAssessmentsForProfiles } from '@/lib/assessmentStorage';

useEffect(() => {
  async function loadMembers() {
    if (!user) {
      setLoading(false);
      return;
    }

    try {
      setLoading(true);
      const profiles = await getProfiles();
      
      // –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –æ—Ü–µ–Ω–æ–∫
      const childProfiles = profiles.filter(p => p.type === 'child');
      const childProfileIds = childProfiles.map(p => p.id);
      
      const assessmentsMap = await getCompletedAssessmentsForProfiles(
        childProfileIds,
        'checkup'
      );
      
      const membersWithAssessments = profiles.map(profile => ({
        ...profile,
        checkupAssessment: assessmentsMap.get(profile.id) || null,
      }));
      
      setFamilyMembers(membersWithAssessments);
    } catch (error) {
      logger.error('Error loading family members:', error);
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    } finally {
      setLoading(false);
    }
  }
  loadMembers();
}, [user]);
```

---

### üü° 2.4. –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ (React re-renders) ‚ö†Ô∏è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- `src/pages/Dashboard.tsx`
- `src/pages/ResultsReportNew.tsx`
- `src/hooks/useAssessment.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–Ω—É–∂–Ω—ã–º —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞–º
- useEffect –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
- –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Üí –æ–Ω–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è
- –í—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useMemo –¥–ª—è –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useCallback –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≥–¥–µ –Ω—É–∂–Ω–æ

**–ö–æ–¥:**

```typescript
// src/pages/Dashboard.tsx
import { useMemo, useCallback } from 'react';

export default function Dashboard() {
  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –¥–∞—Ç
  const membersWithAge = useMemo(() => {
    return familyMembers.map(member => ({
      ...member,
      age: member.dob ? calculateAge(member.dob) : null,
      checkupDate: member.checkupAssessment?.completed_at 
        ? new Date(member.checkupAssessment.completed_at).toLocaleDateString('ru-RU')
        : null,
      hasCompletedCheckup: member.checkupAssessment?.status === 'completed',
    }));
  }, [familyMembers]);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ - –ö–†–ò–¢–ò–ß–ù–û!
  const loadMembers = useCallback(async () => {
    if (!user) {
      setLoading(false);
      return;
    }

    try {
      setLoading(true);
      const profiles = await getProfiles();
      
      const profileIds = profiles.map(p => p.id);
      const assessmentsMap = await getCompletedAssessmentsForProfiles(
        profileIds,
        'checkup'
      );
      
      const membersWithAssessments = profiles.map(profile => ({
        ...profile,
        checkupAssessment: assessmentsMap[profile.id] || null,
      }));
      
      setFamilyMembers(membersWithAssessments);
    } catch (error) {
      logger.error('Error loading family members:', error);
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    } finally {
      setLoading(false);
    }
  }, [user]);

  useEffect(() => {
    loadMembers();
  }, [loadMembers]); // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–ª–∏–∫–∞
  const handleCheckupClick = useCallback(() => {
    const children = familyMembers.filter(m => m.type === 'child');
    
    if (children.length === 0) {
      navigate("/family-members");
      return;
    }
    
    const childrenWithoutCheckup = children.filter(child => 
      !child.checkupAssessment || child.checkupAssessment.status !== 'completed'
    );
    
    if (childrenWithoutCheckup.length === 0) {
      toast.info('–í—Å–µ –¥–µ—Ç–∏ —É–∂–µ –ø—Ä–æ—à–ª–∏ —á–µ–∫–∞–ø! –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–í–∞—à–∞ —Å–µ–º—å—è".');
      return;
    }
    
    const firstChild = childrenWithoutCheckup[0];
    setCurrentProfileId(firstChild.id);
    setCurrentProfile(firstChild);
    navigate(`/checkup-intro/${firstChild.id}`);
  }, [familyMembers, navigate, setCurrentProfileId, setCurrentProfile]);
}
```

```typescript
// src/pages/ResultsReportNew.tsx

// –ö–†–ò–¢–ò–ß–ù–û: –ú–µ–º–æ–∏–∑–∞—Ü–∏—è toggleSection
const toggleSection = useCallback((section: string) => {
  setOpenSections(prev => ({ ...prev, [section]: !prev[section] }));
}, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —Ñ—É–Ω–∫—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞

// –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
const selectedChildCheckup = useMemo(() => {
  return selectedProfileId 
    ? childrenCheckups.find(c => c.profile.id === selectedProfileId)
    : childrenCheckups[0];
}, [selectedProfileId, childrenCheckups]);
```

**–í—ã–∏–≥—Ä—ã—à:** –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤, –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã–π UI

---

### üü° 2.6. Bundle size –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è üì¶

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–æ—Ç –ö–ª–æ–¥–∞)  
**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤  
**–§–∞–π–ª—ã:**
- `src/App.tsx`
- `package.json`
- `vite.config.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- 23 Radix UI –ø–∞–∫–µ—Ç–∞, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ~10
- recharts ~150KB –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –ù–µ—Ç code splitting –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü
- –ò–º–ø–æ—Ä—Ç—ã –∏–∫–æ–Ω–æ–∫ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å lazy loading –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏–∫–æ–Ω–æ–∫
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É recharts (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)

**–ö–æ–¥:**

```typescript
// src/App.tsx
import { lazy, Suspense } from 'react';
import { Loader2 } from 'lucide-react';

// Lazy loading –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
const Dashboard = lazy(() => import('./pages/Dashboard'));
const ResultsReportNew = lazy(() => import('./pages/ResultsReportNew'));
const CheckupQuestions = lazy(() => import('./pages/CheckupQuestions'));
const FamilyQuestions = lazy(() => import('./pages/FamilyQuestions'));
const ParentQuestions = lazy(() => import('./pages/ParentQuestions'));

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏
const PageLoader = () => (
  <div className="flex min-h-screen items-center justify-center">
    <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
  </div>
);

const App = () => (
  <QueryClientProvider client={queryClient}>
    <AuthProvider>
      <ProfileProvider>
        <TooltipProvider>
          <Toaster />
          <Sonner />
          <BrowserRouter>
            <ErrorBoundary>
              <Routes>
                {/* –õ–µ–≥–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É */}
                <Route path="/" element={<Index />} />
                <Route path="/login" element={<Login />} />
                <Route path="/register" element={<Register />} />
                
                {/* –¢—è–∂–µ–ª—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å lazy loading */}
                <Route 
                  path="/dashboard" 
                  element={
                    <ProtectedRoute>
                      <Suspense fallback={<PageLoader />}>
                        <Dashboard />
                      </Suspense>
                    </ProtectedRoute>
                  } 
                />
                <Route 
                  path="/results-report/:profileId?" 
                  element={
                    <ProtectedRoute>
                      <Suspense fallback={<PageLoader />}>
                        <ResultsReportNew />
                      </Suspense>
                    </ProtectedRoute>
                  } 
                />
                {/* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—è–∂–µ–ª—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */}
              </Routes>
            </ErrorBoundary>
          </BrowserRouter>
        </TooltipProvider>
      </ProfileProvider>
    </AuthProvider>
  </QueryClientProvider>
);
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫:**

```typescript
// ‚ùå –ü–ª–æ—Ö–æ - –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å –º–æ–¥—É–ª—å
import { User, CheckCircle2, Clock, Settings } from 'lucide-react';

// ‚úÖ –•–æ—Ä–æ—à–æ - tree-shaking —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å lucide-react
// –ù–æ –º–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
import User from 'lucide-react/dist/esm/icons/user';
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ recharts (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

–ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ—Å—Ç—ã–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ª–µ–≥–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É:
- Chart.js (~50KB) 
- Victory (~80KB)
- –ò–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ SVG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–í—ã–∏–≥—Ä—ã—à:** ~200-300KB –º–µ–Ω—å—à–µ bundle, –±—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

---

### üü° 2.7. –¢–∏–ø–∏–∑–∞—Ü–∏—è RPC —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ  
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `src/types/assessments.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/lib/assessmentStorage.ts`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/lib/supabase.ts`

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ü–µ–Ω–æ–∫
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

**–ö–æ–¥:**

```typescript
// src/types/assessments.ts

export type AssessmentScore = 'typical' | 'concerning' | 'clinical';

export interface CheckupScores {
  emotional: AssessmentScore;
  conduct: AssessmentScore;
  hyperactivity: AssessmentScore;
  peer_problems: AssessmentScore;
  prosocial: AssessmentScore;
  total_difficulties: AssessmentScore;
}

export interface ParentScores {
  emotional_wellbeing: AssessmentScore;
  communication: AssessmentScore;
  boundaries: AssessmentScore;
  consistency: AssessmentScore;
  // ... –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
}

export interface FamilyScores {
  family_functioning: AssessmentScore;
  support_systems: AssessmentScore;
  stress_management: AssessmentScore;
  // ... –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
}

export interface AssessmentResults {
  assessment_type: 'checkup' | 'parent' | 'family';
  scores: CheckupScores | ParentScores | FamilyScores;
  recommendations?: string[];
  summary?: string;
  completed_at: string;
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ assessmentStorage.ts:**

```typescript
// src/lib/assessmentStorage.ts
import type { AssessmentResults, CheckupScores } from '@/types/assessments';

export async function completeAssessment(
  assessmentId: string
): Promise<AssessmentResults> {
  try {
    const { data, error } = await supabase.rpc('complete_assessment', {
      assessment_uuid: assessmentId,
    });

    if (error) throw error;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    return data as AssessmentResults;
  } catch (error) {
    logger.error('Error completing assessment:', error);
    throw error;
  }
}
```

---

### üü° 2.8. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ setTimeout –≤ Register.tsx

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–∞–∂–Ω–æ  
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–§–∞–π–ª:** `src/pages/Register.tsx`

**–ó–∞–¥–∞—á–∏:**
- [ ] –£–±—Ä–∞—Ç—å setTimeout
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ö–æ–¥:**

```typescript
// src/pages/Register.tsx
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  setLoading(true);

  try {
    const result = await signUp(email, password);
    const { data, error } = result;

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, email confirmation)
    if (data?.user) {
      toast.success('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å.');
      navigate('/profile');
      return;
    }

    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–Ω
    if (error) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å email confirmation
      const isEmailError = 
        error.message?.toLowerCase().includes('email') ||
        error.message?.toLowerCase().includes('confirmation');

      if (isEmailError) {
        // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏ —Å—Ä–∞–∑—É - –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        const signInResult = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (signInResult.data?.user) {
          toast.success('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å.');
          navigate('/profile');
          return;
        }
      }

      toast.error(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
    } else {
      toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    }
  } catch (err: unknown) {
    logger.error('Registration exception:', err);
    toast.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
  } finally {
    setLoading(false);
  }
};
```

---

## –§–ê–ó–ê 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)

### üü¢ 3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ  
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `vitest.config.ts`
- –°–æ–∑–¥–∞—Ç—å: `src/__tests__/`

**–ó–∞–¥–∞—á–∏:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Vitest –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Ç–µ—Å—Ç—ã

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react-swc';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/__tests__/setup.ts'],
    css: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤:**

```typescript
// src/__tests__/lib/authUtils.test.ts
import { describe, it, expect } from 'vitest';
import { isSessionValid } from '@/lib/authUtils';
import type { Session } from '@supabase/supabase-js';

describe('isSessionValid', () => {
  it('–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false –¥–ª—è null —Å–µ—Å—Å–∏–∏', () => {
    expect(isSessionValid(null)).toBe(false);
  });

  it('–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏', () => {
    const session: Session = {
      // ... mock session —Å –±—É–¥—É—â–∏–º expires_at
    } as Session;
    expect(isSessionValid(session)).toBe(true);
  });

  it('–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false –¥–ª—è –∏—Å—Ç–µ–∫—à–µ–π —Å–µ—Å—Å–∏–∏', () => {
    const session: Session = {
      expires_at: Math.floor(Date.now() / 1000) - 100,
    } as Session;
    expect(isSessionValid(session)).toBe(false);
  });
});
```

---

### üü¢ 3.2. –°–æ–∑–¥–∞–Ω–∏–µ README.md

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª:** `README.md`

**–ó–∞–¥–∞—á–∏:**
- [ ] –û–ø–∏—Å–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
- [ ] –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ README:**

```markdown
# Little Otter / Balansity

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ–º—å–∏.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- React 18 + TypeScript
- Vite
- Supabase (PostgreSQL + Auth)
- Tailwind CSS + shadcn/ui
- React Router
- React Query

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

\`\`\`bash
npm install
\`\`\`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ \`.env.example\` –≤ \`.env\`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - \`VITE_SUPABASE_URL\`
   - \`VITE_SUPABASE_ANON_KEY\`

## –ó–∞–ø—É—Å–∫

\`\`\`bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build

# –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–±–æ—Ä–∫–∏
npm run preview
\`\`\`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

\`\`\`
src/
‚îú‚îÄ‚îÄ components/    # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ contexts/      # React –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (Auth, Profile)
‚îú‚îÄ‚îÄ hooks/         # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏
‚îú‚îÄ‚îÄ lib/           # –£—Ç–∏–ª–∏—Ç—ã –∏ API –∫–ª–∏–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ pages/         # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ types/         # TypeScript —Ç–∏–ø—ã
\`\`\`

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ \`supabase/migrations/\`.

–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
\`\`\`bash
supabase migration up
\`\`\`
```

---

### üü¢ 3.3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Error Boundaries

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ  
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å: `src/components/ErrorBoundary.tsx`
- –û–±–Ω–æ–≤–∏—Ç—å: `src/App.tsx`

**–ö–æ–¥:**

```typescript
// src/components/ErrorBoundary.tsx
import React, { Component, ErrorInfo, ReactNode } from 'react';
import { Button } from '@/components/ui/button';
import { logger } from '@/lib/logger';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false,
    error: null,
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    logger.error('ErrorBoundary caught an error:', error, errorInfo);
    // TODO: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Sentry –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å
  }

  private handleReset = () => {
    this.setState({ hasError: false, error: null });
    window.location.href = '/';
  };

  public render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <div className="flex min-h-screen items-center justify-center p-4">
          <div className="max-w-md text-center space-y-4">
            <h1 className="text-2xl font-bold">–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h1>
            <p className="text-muted-foreground">
              –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.
            </p>
            {this.state.error && import.meta.env.DEV && (
              <pre className="text-xs text-left bg-muted p-4 rounded overflow-auto">
                {this.state.error.toString()}
              </pre>
            )}
            <Button onClick={this.handleReset}>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</Button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ App.tsx:**

```typescript
// src/App.tsx
import { ErrorBoundary } from '@/components/ErrorBoundary';

const App = () => (
  <ErrorBoundary>
    <QueryClientProvider client={queryClient}>
      {/* ... */}
    </QueryClientProvider>
  </ErrorBoundary>
);
```

---

## –§–ê–ó–ê 4: –£–ª—É—á—à–µ–Ω–∏—è TypeScript (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, 5-7 –¥–Ω–µ–π)

### üîµ 4.1. –í–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ  
**–í—Ä–µ–º—è:** 3-5 –¥–Ω–µ–π (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)  
**–§–∞–π–ª:** `tsconfig.json`

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. –í–∫–ª—é—á–∏—Ç—å –æ–¥–Ω—É –ø—Ä–æ–≤–µ—Ä–∫—É
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
3. –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π

**–ü–ª–∞–Ω:**

```json
// –®–∞–≥ 1: –í–∫–ª—é—á–∏—Ç—å noUnusedLocals
{
  "noUnusedLocals": true
}
// –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏

// –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç—å noUnusedParameters
{
  "noUnusedParameters": true
}
// –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏

// –®–∞–≥ 3: –í–∫–ª—é—á–∏—Ç—å strictNullChecks
{
  "strictNullChecks": true
}
// –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)

// –®–∞–≥ 4: –í–∫–ª—é—á–∏—Ç—å noImplicitAny (–ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥)
{
  "noImplicitAny": true
}
// –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏
```

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞:**
- [ ] –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run build`
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ TypeScript
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### üîµ 4.2. –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö `any` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ  
**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è  
**–§–∞–π–ª—ã:** –í—Å–µ —Ñ–∞–π–ª—ã —Å `any`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `any` (—É–∂–µ –µ—Å—Ç—å –≤ –æ—Ç—á–µ—Ç–µ)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `unknown` —Å type guards –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

**–ü—Ä–∏–º–µ—Ä—ã:**

```typescript
// –ë—ã–ª–æ:
catch (err: any) {
  console.error(err.message);
}

// –°—Ç–∞–ª–æ:
catch (err: unknown) {
  if (err instanceof Error) {
    logger.error(err.message);
  } else {
    logger.error('Unknown error:', err);
  }
}
```

---

## –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)
- [ ] 1.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] 1.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] 1.3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–π
- [ ] 1.4. –ó–∞–º–µ–Ω–∞ alert() –Ω–∞ toast
- [ ] 1.5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞

### –§–∞–∑–∞ 2 (–í–∞–∂–Ω–æ)
- [ ] 2.1. –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- [ ] 2.2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º —Å Zod
- [ ] 2.3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL —Ñ—É–Ω–∫—Ü–∏–π (5 SELECT ‚Üí 1)
- [ ] 2.3.1. –ë–∞—Ç—á–µ–≤—ã–π UPDATE –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 010
- [ ] 2.3.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ React Query –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] 2.4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ (useCallback, useMemo)
- [ ] 2.5. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ UI updates
- [ ] 2.6. Bundle size –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] 2.7. –¢–∏–ø–∏–∑–∞—Ü–∏—è RPC —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] 2.8. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ setTimeout

### –§–∞–∑–∞ 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
- [ ] 3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] 3.2. –°–æ–∑–¥–∞–Ω–∏–µ README.md
- [ ] 3.3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Error Boundaries

### –§–∞–∑–∞ 4 (–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)
- [ ] 4.1. –í–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ (–ø–æ—à–∞–≥–æ–≤–æ)
- [ ] 4.2. –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö `any`

---

## –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

| –§–∞–∑–∞ | –í—Ä–µ–º—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|-------|-----------|
| –§–∞–∑–∞ 1 | 4-5 –¥–Ω–µ–π | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –æ—Ç –ö–ª–æ–¥–∞) |
| –§–∞–∑–∞ 2 | 7-9 –¥–Ω–µ–π | üü° –í–∞–∂–Ω–æ (—Ä–∞—Å—à–∏—Ä–µ–Ω –ø–ª–∞–Ω) |
| –§–∞–∑–∞ 3 | 3-5 –¥–Ω–µ–π | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |
| –§–∞–∑–∞ 4 | 5-7 –¥–Ω–µ–π | üîµ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ |
| **–ò—Ç–æ–≥–æ** | **19-26 –¥–Ω–µ–π** | |

---

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –±—ã—Å—Ç—Ä–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:

1. **–î–µ–Ω—å 1:** 1.1, 1.2, 1.3 (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, env, —Å–µ—Å—Å–∏–∏)
2. **–î–µ–Ω—å 2:** 1.4, 1.5, 2.1 (alert, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—à–∏–±–∫–∏)
3. **–î–µ–Ω—å 3:** 2.3, 2.4 (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î, –º–µ–º–æ–∏–∑–∞—Ü–∏—è)
4. **–î–µ–Ω—å 4:** 2.2 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º)
5. **–î–µ–Ω—å 5:** 2.5, 2.6 (—Ç–∏–ø—ã RPC, setTimeout)

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –û—Å—Ç–∞–ª—å–Ω–æ–µ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Sentry –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
```typescript
// src/lib/logger.ts - —Ä–∞—Å—à–∏—Ä–∏—Ç—å
import * as Sentry from "@sentry/react";

class Logger {
  error(...args: unknown[]): void {
    console.error('[ERROR]', ...args);
    if (import.meta.env.PROD) {
      Sentry.captureException(args[0]);
    }
  }
}
```

### Code splitting
–î–æ–±–∞–≤–∏—Ç—å lazy loading –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü:
```typescript
// src/App.tsx
import { lazy, Suspense } from 'react';

const Dashboard = lazy(() => import('./pages/Dashboard'));

<Suspense fallback={<div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>}>
  <Route path="/dashboard" element={<ProtectedRoute><Dashboard /></ProtectedRoute>} />
</Suspense>
```

### CI/CD
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
- –õ–∏–Ω—Ç–∏–Ω–≥
- –¢–∏–ø—ã
- –¢–µ—Å—Ç—ã
- –°–±–æ—Ä–∫–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024

